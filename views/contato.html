<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <link rel="icon" href="imagens/LogoConectaEdu.png" type="image/png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contato - ConectaEdu</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', Helvetica, Arial, sans-serif; }
    body { background: linear-gradient(135deg, #f8f9fa, #ffffff); color: #1d1d1f; line-height: 1.6; }
    .background-shapes { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; overflow: hidden; }
    .shape { position: absolute; opacity: 0.15; animation: float 20s infinite ease-in-out; will-change: transform; }
    .shape.circle { border-radius: 50%; background: linear-gradient(135deg, #007aff, #0056b3); }
    .shape.square { background: linear-gradient(135deg, #007aff, #0056b3); border-radius: 20px; }
    .shape:nth-child(1){width:300px;height:300px;top:10%;left:5%;animation-delay:0s;animation-duration:25s;}
    .shape:nth-child(2){width:200px;height:200px;top:60%;right:10%;animation-delay:3s;animation-duration:20s;}
    .shape:nth-child(3){width:150px;height:150px;bottom:15%;left:15%;animation-delay:6s;animation-duration:30s;}
    .shape:nth-child(4){width:250px;height:250px;top:40%;right:20%;animation-delay:9s;animation-duration:22s;}
    .shape:nth-child(5){width:180px;height:180px;top:70%;left:40%;animation-delay:12s;animation-duration:28s;}
    .shape:nth-child(6){width:220px;height:220px;top:20%;right:35%;animation-delay:15s;animation-duration:26s;}
    @keyframes float{0%,100%{transform:translate(0,0)rotate(0deg);}25%{transform:translate(30px,-30px)rotate(90deg);}50%{transform:translate(-20px,20px)rotate(180deg);}75%{transform:translate(20px,30px)rotate(270deg);}}
    header,main,footer{position:relative;z-index:1;}
    header{background:rgba(255,255,255,0.8);backdrop-filter:blur(20px);border-bottom:1px solid rgba(0,0,0,0.05);padding:20px 0;position:fixed;top:0;left:0;right:0;z-index:1000;}
    .header-content{max-width:1200px;margin:0 auto;padding:0 24px;display:flex;justify-content:space-between;align-items:center;}
    .logo{display:flex;align-items:center;gap:12px;text-decoration:none;color:inherit;}
    .logo img{width:40px;height:40px;border-radius:10px;}
    .logo h1{font-size:24px;font-weight:700;color:#1d1d1f;}
    nav ul{display:flex;list-style:none;gap:32px;align-items:center;}
    nav ul li a{text-decoration:none;color:#1d1d1f;font-weight:500;font-size:16px;transition:color 0.3s ease;}
    nav ul li a:hover{color:#007aff;}
    nav ul li a.active{color:#007aff;font-weight:600;}
    .user-section{display:flex;align-items:center;gap:16px;}
    .user-menu{position:relative;}
    .user-button{display:flex;align-items:center;gap:12px;background:#fff;border:2px solid #e5e5e7;padding:10px 20px;border-radius:12px;cursor:pointer;transition:all 0.3s ease;}
    .user-button:hover{border-color:#007aff;box-shadow:0 4px 12px rgba(0,122,255,0.15);}
    .user-avatar{width:36px;height:36px;border-radius:50%;background:#007aff;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:16px;}
    .user-name{font-weight:600;color:#1d1d1f;}
    .dropdown-arrow{font-size:12px;color:#86868b;transition:transform 0.3s ease;}
    .user-button.active .dropdown-arrow{transform:rotate(180deg);}
    .dropdown-menu{position:absolute;top:calc(100% + 8px);right:0;background:#fff;border-radius:12px;box-shadow:0 20px 40px rgba(0,0,0,0.15);border:1px solid rgba(0,0,0,0.05);min-width:220px;opacity:0;visibility:hidden;transform:translateY(-10px);transition:all 0.3s ease;}
    .dropdown-menu.show{opacity:1;visibility:visible;transform:translateY(0);}
    .dropdown-item{display:flex;align-items:center;gap:12px;padding:14px 20px;color:#1d1d1f;text-decoration:none;transition:background 0.2s ease;border-bottom:1px solid #f5f5f7;}
    .dropdown-item:last-child{color:#ff3b30;border-bottom:none;}
    .dropdown-item:hover{background:#f5f5f7;}
    .sign-up {
            background: #007aff;
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .sign-up:hover {
            background: #0056b3;
            transform: translateY(-1px);
            box-shadow: 0 8px 20px rgba(0, 122, 255, 0.3);
        }
    main{margin-top:80px;min-height:calc(100vh - 80px);padding:60px 24px;}
    .container{max-width:800px;margin:0 auto;}
    .page-header{text-align:center;margin-bottom:48px;}
    .page-header h2{font-size:48px;font-weight:700;color:#1d1d1f;margin-bottom:16px;}
    .page-header p{font-size:21px;color:#86868b;max-width:600px;margin:0 auto;}
    .contact-container{background:#fff;border-radius:24px;padding:48px;box-shadow:0 20px 40px rgba(0,0,0,0.08);border:1px solid rgba(0,0,0,0.05);}
    .form-section h3{font-size:28px;font-weight:700;color:#1d1d1f;margin-bottom:24px;text-align:center;}
    .form-group{margin-bottom:24px;}
    .form-group label{display:block;color:#1d1d1f;font-size:14px;font-weight:600;margin-bottom:8px;}
    input,textarea{width:100%;padding:16px;border:2px solid #e5e5e7;border-radius:12px;background:#fff;color:#1d1d1f;font-size:16px;outline:none;transition:all 0.3s ease;font-family:inherit;}
    input:focus,textarea:focus{border-color:#007aff;box-shadow:0 0 0 4px rgba(0,122,255,0.1);}
    textarea{min-height:150px;resize:vertical;}
    .char-count{text-align:right;font-size:12px;color:#86868b;margin-top:4px;}
    button{background:#007aff;color:#fff;border:none;padding:18px 32px;width:100%;border-radius:12px;cursor:pointer;font-weight:600;font-size:18px;transition:all 0.3s ease;margin-top:8px;}
    button:hover{background:#0056b3;transform:translateY(-2px);box-shadow:0 12px 24px rgba(0,122,255,0.3);}
    .success-message,.error-message{display:none;align-items:center;gap:12px;padding:20px;border-radius:12px;margin-bottom:24px;font-weight:600;font-size:16px;}
    .success-message{background:#e8f5e9;border:2px solid #4caf50;color:#2e7d32;}
    .error-message{background:#ffebee;border:2px solid #f44336;color:#c62828;}
    .success-message.show,.error-message.show{display:flex;}
    footer{background:#f5f5f7;padding:40px 24px;text-align:center;border-top:1px solid rgba(0,0,0,0.05);}
    footer p{color:#86868b;font-size:14px;}
  </style>
</head>
<body>
  <div class="background-shapes">
    <div class="shape circle"></div><div class="shape square"></div><div class="shape circle"></div>
    <div class="shape square"></div><div class="shape circle"></div><div class="shape square"></div>
  </div>

  <!-- HEADER dinâmico igual ao da home -->
  <header>
    <div class="header-content">
      <a href="/" class="logo">
        <img src="imagens/LogoConectaEdu.png" alt="logo">
        <h1>ConectaEdu</h1>
      </a>
      <nav>
        <ul>
          <li><a href="/sobre">Sobre Nós</a></li>
          <li><a href="#" style="opacity: 0.5; cursor: not-allowed;" onclick="return false;">Cursos</a></li>
          <li><a href="/contato" class="active">Contato</a></li>
          <li><a href="#" style="opacity: 0.5; cursor: not-allowed;" onclick="return false;">Assistente Virtual</a></li>
        </ul>
      </nav>
      <div class="user-section" id="userSection"></div>
    </div>
  </header>

  <main>
    <div class="container">
      <div class="page-header">
        <h2>Entre em Contato</h2>
        <p>Tem alguma dúvida ou sugestão? Envie uma mensagem e retornaremos em breve!</p>
      </div>

      <div class="contact-container">
        <div class="form-section">
          <h3>Envie sua Mensagem</h3>

          <div class="success-message" id="successMessage">✓ Mensagem enviada com sucesso!</div>
          <div class="error-message" id="errorMessage">✗ Erro ao enviar. Tente novamente.</div>

          <form id="contactForm">
            <div class="form-group">
              <label for="nome">Nome Completo</label>
              <input type="text" id="nome" name="nome" placeholder="Digite seu nome completo" required>
            </div>
            <div class="form-group">
              <label for="email">Email</label>
              <input type="email" id="email" name="email" placeholder="seu@email.com" required>
            </div>
            <div class="form-group">
              <label for="mensagem">Mensagem</label>
              <textarea id="mensagem" name="mensagem" placeholder="Escreva sua mensagem..." maxlength="1000" required></textarea>
              <div class="char-count"><span id="charCount">0</span>/1000 caracteres</div>
            </div>
            <button type="submit" id="submitBtn">Enviar Mensagem</button>
          </form>
        </div>
      </div>
    </div>
  </main>

  <footer><p>©2025 ConectaEdu. All rights reserved.</p></footer>

  <script>
    // --- Header Dinâmico ---
    let usuarioLogado = false;
    let nomeUsuario = '';
    let corAvatar = '#007aff';

    fetch('/status')
      .then(r => r.json())
      .then(data => {
        usuarioLogado = data.logado;
        nomeUsuario = data.usuario || '';
        renderUserSection();

        if (data.logado) {
          fetch('/perfil/dados')
            .then(r => r.json())
            .then(profile => {
              if (profile?.corAvatar) {
                corAvatar = profile.corAvatar;
                document.getElementById('userAvatar')?.style.setProperty('background', corAvatar);
              }
            });
        }
      })
      .catch(() => renderUserSection());

    function renderUserSection() {
      const userSection = document.getElementById('userSection');
      if (usuarioLogado) {
        const initial = nomeUsuario.charAt(0).toUpperCase();
        userSection.innerHTML = `
          <div class="user-menu">
            <div class="user-button" onclick="toggleDropdown()">
              <div class="user-avatar" id="userAvatar" style="background: ${corAvatar};">${initial}</div>
              <span class="user-name">${nomeUsuario}</span>
              <span class="dropdown-arrow">▼</span>
            </div>
            <div class="dropdown-menu" id="dropdownMenu">
              <a href="/plataforma" class="dropdown-item">Ir para Plataforma</a>
              <a href="/perfil" class="dropdown-item">Configurar Perfil</a>
              <a href="/sair" class="dropdown-item">Sair da Conta</a>
            </div>
          </div>`;
      } else {
        userSection.innerHTML = `<a href="/login" class="sign-up">Sign In</a>`;
      }
    }

    function toggleDropdown() {
      const dropdown = document.getElementById('dropdownMenu');
      const button = document.querySelector('.user-button');
      dropdown.classList.toggle('show');
      button.classList.toggle('active');
    }

    document.addEventListener('click', e => {
      const userMenu = document.querySelector('.user-menu');
      if (userMenu && !userMenu.contains(e.target)) {
        document.getElementById('dropdownMenu')?.classList.remove('show');
        document.querySelector('.user-button')?.classList.remove('active');
      }
    });

    // --- Formulário de Contato ---
    const form = document.getElementById('contactForm');
    const mensagemTextarea = document.getElementById('mensagem');
    const charCount = document.getElementById('charCount');
    const submitBtn = document.getElementById('submitBtn');
    const successMessage = document.getElementById('successMessage');
    const errorMessage = document.getElementById('errorMessage');

    mensagemTextarea.addEventListener('input', () => charCount.textContent = mensagemTextarea.value.length);

    form.addEventListener('submit', async e => {
      e.preventDefault();
      submitBtn.disabled = true;
      submitBtn.textContent = 'Enviando...';
      successMessage.classList.remove('show');
      errorMessage.classList.remove('show');

      const formData = {
        nome: document.getElementById('nome').value,
        email: document.getElementById('email').value,
        mensagem: document.getElementById('mensagem').value,
        data: new Date().toISOString()
      };

      try {
        const response = await fetch('/contato/enviar', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(formData)
        });

        if (response.ok) {
          successMessage.classList.add('show');
          form.reset();
          charCount.textContent = '0';
          window.scrollTo({ top: 0, behavior: 'smooth' });
          setTimeout(() => successMessage.classList.remove('show'), 5000);
        } else throw new Error();
      } catch {
        errorMessage.classList.add('show');
        setTimeout(() => errorMessage.classList.remove('show'), 5000);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Enviar Mensagem';
      }
    });
  </script>
</body>
</html>
